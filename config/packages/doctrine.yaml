# config/packages/doctrine.yaml
doctrine:
  dbal:
    # DSN principal dÃƒÆ’Ã‚Â©fini dans .env / .env.local
    url: '%env(resolve:DATABASE_URL)%'

    # Forcer la version exacte de MariaDB (ÃƒÆ’Ã‚Â©vite erreurs Doctrine avec migrations)
    server_version: 'mariadb-10.4.32'

    # Charset par dÃƒÆ’Ã‚Â©faut (UTF-8 full)
    charset: utf8mb4
    default_table_options:
      charset: utf8mb4
      collate: utf8mb4_unicode_ci

  orm:
    # GÃƒÆ’Ã‚Â©nÃƒÆ’Ã‚Â©ration auto des proxies (utile en dev, dÃƒÆ’Ã‚Â©sactivÃƒÆ’Ã‚Â© en prod)
    auto_generate_proxy_classes: true
    enable_lazy_ghost_objects: true

    naming_strategy: doctrine.orm.naming_strategy.underscore_number_aware
    auto_mapping: true

    mappings:
      App:
        is_bundle: false
        type: attribute
        dir: '%kernel.project_dir%/src/Entity'
        prefix: 'App\Entity'
        alias: App

when@test:
  doctrine:
    dbal:
      # DB dÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©diÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©e aux tests (purgÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©e ÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â  chaque run)
      url: '%env(resolve:DATABASE_URL_TEST)%'
    orm:
      auto_generate_proxy_classes: true

when@prod:
  doctrine:
    orm:
      # En prod, les proxies sont gÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©nÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©rÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©s au dÃƒÆ’Ã†â€™Ãƒâ€šÃ‚Â©ploiement ÃƒÆ’Ã‚Â¢ÃƒÂ¢Ã¢â‚¬Å¡Ã‚Â¬ÃƒÂ¢Ã¢â€šÂ¬Ã…â€œ meilleures perfs
      auto_generate_proxy_classes: false
