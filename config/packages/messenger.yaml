framework:
  messenger:
    # Transport par défaut pour les messages échoués
    failure_transport: failed

    transports:
      # Transport asynchrone principal (emails, notifications, jobs)
      async:
        dsn: '%env(MESSENGER_TRANSPORT_DSN)%'
        options:
          use_notify: true
          check_delayed_interval: 60000
        retry_strategy:
          max_retries: 3
          multiplier: 2

      # Transport dédié aux messages échoués
      failed: 'doctrine://default?queue_name=failed'

    routing:
      # Routage Symfony natif (emails via Mailer)
      Symfony\Component\Mailer\Messenger\SendEmailMessage: async

      # Routage pour les messages personnalisés TalentÉkô
      App\Message\NewMessageNotification: async
      App\Message\NewExchangeCreatedNotification: async
      App\Message\ExchangeStatusChangedNotification: async
