{# ========================== #
# templates/profile/edit.html.twig
# ========================== #}
{% extends 'base.html.twig' %}

{% block title %}Modifier mon profil | TalentÉkô{% endblock %}

{% block body %}
<section class="bg-talenteko-peach-100 py-12">
  <div class="max-w-2xl mx-auto px-6">
    <h1 class="text-3xl font-bold text-talenteko-orange-500 mb-6 text-center">
      Modifier mon profil
    </h1>

    {# --- Bandeau erreurs global --- #}
    {% if not form.vars.valid and form.vars.submitted %}
      <div id="form-global-errors" class="mb-4 rounded-lg border border-red-300 bg-red-50 text-red-700 p-3" role="alert">
        <strong class="font-semibold">Le formulaire contient des erreurs.</strong>
        <span class="ml-1">Merci de corriger les champs en rouge.</span>
      </div>
    {% endif %}

    <div class="rounded-2xl bg-white p-6 shadow-sm">
      {{ form_start(form, { attr: { novalidate: 'novalidate', id: 'profile-form', class: 'tk-form' } }) }}

      <div class="space-y-6">

        {# ========== PSEUDO ========== #}
        {% set pseudoInvalid = (form_errors(form.pseudo) is not empty) %}
        {% set pseudoErrorsId = form.pseudo.vars.id ~ '-errors' %}
        <div>
          <label for="{{ form.pseudo.vars.id }}" class="form-label">Pseudonyme</label>
          {{ form_widget(form.pseudo, {
            attr: {
              class: 'form-input' ~ (pseudoInvalid ? ' is-invalid' : ''),
              'aria-invalid': pseudoInvalid ? 'true' : 'false',
              'aria-describedby': pseudoInvalid ? pseudoErrorsId : null
            }
          }) }}
          {% if pseudoInvalid %}
            <p id="{{ pseudoErrorsId }}" class="form-error" role="alert">{{ form_errors(form.pseudo) }}</p>
          {% endif %}
        </div>

        {# ========== LOCALISATION ========== #}
        {% set locInvalid = (form_errors(form.location) is not empty) %}
        {% set locErrorsId = form.location.vars.id ~ '-errors' %}
        <div>
          <label for="{{ form.location.vars.id }}" class="form-label">Localisation</label>
          {{ form_widget(form.location, {
            attr: {
              class: 'form-input' ~ (locInvalid ? ' is-invalid' : ''),
              'aria-invalid': locInvalid ? 'true' : 'false',
              'aria-describedby': locInvalid ? locErrorsId : null
            }
          }) }}
          {% if locInvalid %}
            <p id="{{ locErrorsId }}" class="form-error" role="alert">{{ form_errors(form.location) }}</p>
          {% endif %}
        </div>

        {# ========== BIO ========== #}
        <div>
          <label for="{{ form.bio.vars.id }}" class="form-label">Biographie</label>
          {{ form_widget(form.bio, { attr: { class: 'form-textarea', rows: 4 } }) }}
          {{ form_errors(form.bio) }}
        </div>

        {# ========== COMPÉTENCES PROPOSÉES ========== #}
        <div>
          <label for="{{ form.skills_offered.vars.id }}" class="form-label">Compétences proposées</label>
          {{ form_widget(form.skills_offered, { attr: { class: 'form-input' } }) }}
          {{ form_errors(form.skills_offered) }}
        </div>

        {# ========== COMPÉTENCES RECHERCHÉES ========== #}
        <div>
          <label for="{{ form.skills_wanted.vars.id }}" class="form-label">Compétences recherchées</label>
          {{ form_widget(form.skills_wanted, { attr: { class: 'form-input' } }) }}
          {{ form_errors(form.skills_wanted) }}
        </div>

        {# ========== AVATAR (upload) ========== #}
        {% set avatarInvalid = (form_errors(form.avatar) is not empty) %}
        {% set avatarErrorsId = form.avatar.vars.id ~ '-errors' %}
        <div>
          <label for="{{ form.avatar.vars.id }}" class="form-label">Photo de profil</label>
          {{ form_widget(form.avatar, {
            attr: {
              class: (avatarInvalid ? 'is-invalid' : ''),
              'aria-invalid': avatarInvalid ? 'true' : 'false',
              'aria-describedby': avatarInvalid ? avatarErrorsId : null
            }
          }) }}
          {% if avatarInvalid %}
            <p id="{{ avatarErrorsId }}" class="form-error" role="alert">{{ form_errors(form.avatar) }}</p>
          {% endif %}
        </div>

      </div>

      <button class="btn-primary btn-block mt-6">Enregistrer</button>
      {{ form_end(form) }}
    </div>
  </div>
</section>
{% endblock %}
