{# ================================
  partials/_listing_card.html.twig
  Carte annonce TalentÉkô (design V2, clean — Solution B)
  ================================ #}

<div class="card-listing">
  {# --- Bouton Favoris (Stimulus toggle) --- #}
  <button
    type="button"
    class="card-favorite"
    aria-label="Ajouter ou retirer des favoris"
    data-controller="favorite-toggle"
    data-action="click->favorite-toggle#toggle"
  >
    <span data-favorite-toggle-target="empty">
      <i class="fa-regular fa-heart" aria-hidden="true"></i>
    </span>
    <span data-favorite-toggle-target="filled" class="hidden">
      <i class="fa-solid fa-heart" aria-hidden="true"></i>
    </span>
  </button>

  {# --- Image principale --- #}
  <a href="{{ path('app_listing_show', {slug: listing.slug}) }}" class="card-image-link">
    <div class="card-image-wrapper">
      {% if listing.images|length > 0 %}
        {% set img_path = listing.images|first.path %}

        {% if img_path == 'placeholderTE.png' %}
          {# Cas placeholder global #}
          <img
            src="{{ asset('uploads/listings/placeholderTE.png')|imagine_filter('listing_card') }}"
            alt="Image non disponible"
            class="card-image"
            loading="lazy"
            width="400"
            height="225"
          />
        {% else %}
          {# Cas image locale (dans le sous-dossier de catégorie) #}
          <img
            src="{{ asset('uploads/listings/' ~ listing.category.slug ~ '/' ~ img_path)|imagine_filter('listing_card') }}"
            alt="Image du listing {{ listing.title|e }}"
            class="card-image"
            loading="lazy"
            width="400"
            height="225"
          />
        {% endif %}
      {% else %}
        {# Fallback ultime si aucun enregistrement image #}
        <img
          src="{{ asset('uploads/listings/placeholderTE.png')|imagine_filter('listing_card') }}"
          alt="Image non disponible"
          class="card-image"
          loading="lazy"
          width="400"
          height="225"
        />
      {% endif %}
    </div>

    {# --- Contenu texte --- #}
    <div class="card-content">
      <span class="card-category">
        {{ listing.category.name ?? 'Non classée' }}
      </span>

      <h3 class="card-title">
        <a href="{{ path('app_listing_show', {slug: listing.slug}) }}" class="card-title-link">
          {{ listing.title }}
        </a>
      </h3>

      <p class="card-text">
        {{ listing.description }}
      </p>

      <div class="card-footer">
        <div class="card-author">
          <div class="card-avatar" aria-hidden="true">
            {{ (listing.author.pseudo ?? 'M')|slice(0, 1)|upper }}
          </div>
          <span class="card-author-name">
            {{ listing.author.pseudo ?? 'Membre' }}
          </span>
        </div>

        {% if listing.location %}
          <span class="card-location">
            <i class="fa fa-map-marker-alt card-location-icon" aria-hidden="true"></i>
            {{ listing.location }}
          </span>
        {% endif %}
      </div>
    </div>
  </a>
</div>
