{# ========================================== #
# Partial Twig : Champ mot de passe
# Usage : 
# {% include "partials/_password_field.html.twig" with {
#   field: form.plainPassword.first,
#   label: "Mot de passe",
#   target: "original"
# } %}
#
# target peut être "original" ou "confirm"
# ========================================== #}

{% set isInvalid = (form_errors(field) is not empty) %}
{% set errorsId = field.vars.id ~ '-errors' %}

<div>
  <label for="{{ field.vars.id }}" class="form-label">
    {{ label }} <span class="form-required" aria-hidden="true">*</span>
  </label>

  {{ form_widget(field, {
    attr: {
      placeholder: '••••••••',
      class: 'form-input' ~ (isInvalid ? ' is-invalid' : ''),
      'aria-invalid': isInvalid ? 'true' : 'false',
      'aria-describedby': isInvalid ? errorsId : null,
      'data-password-strength-target': target == 'original' ? 'input' : null,
      'data-password-confirm-target': target,
      'data-action': target == 'original'
        ? 'input->password-strength#check input->password-confirm#check'
        : 'input->password-confirm#check'
    }
  }) }}

  {% if isInvalid %}
    <p id="{{ errorsId }}" class="form-error" role="alert">
      {{ form_errors(field) }}
    </p>
  {% endif %}

  {# Zone de feedback Stimulus #}
  <p class="text-xs mt-1"
     aria-live="polite"
     data-password-strength-target="{{ target == 'original' ? 'feedback' : '' }}"
     data-password-confirm-target="{{ target == 'confirm' ? 'feedback' : '' }}"></p>
</div>
