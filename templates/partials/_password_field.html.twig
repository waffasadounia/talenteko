{# ==========================================
  Partial Twig : Champ mot de passe
  ========================================== #}

{% set is_invalid = (form_errors(field) is not empty) %}
{% set errors_id = field.vars.id ~ '-errors' %}

<div class="space-y-1">
  <label for="{{ field.vars.id }}" class="form-label">
    {{ label }}
    <span class="form-required" aria-hidden="true">*</span>
  </label>

  {# Construction des attributs dynamiques #}
  {% set widget_attr = {
    placeholder: '.....',
    class: 'form-input' ~ (is_invalid ? ' is-invalid' : ''),
    'aria-invalid': is_invalid ? 'true' : 'false',
    'aria-describedby': is_invalid ? errors_id : null,
    'data-password-confirm-target': target
  } %}

  {% if target == 'original' %}
    {% set widget_attr = widget_attr|merge({
      'data-password-strength-target': 'input',
      'data-action': 'input->password-strength#check input->password-confirm#check'
    }) %}
  {% else %}
    {% set widget_attr = widget_attr|merge({
      'data-action': 'input->password-confirm#check'
    }) %}
  {% endif %}

  {{ form_widget(field, { attr: widget_attr }) }}

  {% if is_invalid %}
    <p id="{{ errors_id }}" class="form-error" role="alert">
      {{ form_errors(field) }}
    </p>
  {% endif %}

  {# Zone de feedback Stimulus (accessibilit√©) #}
  {% if target == 'original' %}
    <p class="text-xs mt-1" aria-live="polite" data-password-strength-target="feedback"></p>
  {% elseif target == 'confirm' %}
    <p class="text-xs mt-1" aria-live="polite" data-password-confirm-target="feedback"></p>
  {% else %}
    <p class="text-xs mt-1" aria-live="polite"></p>
  {% endif %}
</div>
