{# templates/listing/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}
  {{ listing.title }} | TalentÉkô
{% endblock %}

{% block body %}
  {# ===== Bandeau d'en-tête ===== #}
  <section class="bg-talenteko-peach-100 py-8">
    <div class="mx-auto max-w-6xl px-4">
      <p class="mb-3 text-sm">
        <a href="{{ path('app_home') }}" class="text-talenteko-orange-500 hover:underline">
          Accueil
        </a>
        <span class="text-gray-400">/</span>
        <span class="text-gray-600">Annonce</span>
      </p>

      <h1 class="text-talenteko-blue-900 text-3xl font-extrabold md:text-4xl">
        {{ listing.title }}
      </h1>

      <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-600">
        {% if listing.category %}
          <span>Catégorie : <strong>{{ listing.category.name ?? 'Non classée' }}</strong></span>
        {% endif %}
        {% if listing.location %}
          <span>Ville : <strong>{{ listing.location }}</strong></span>
        {% endif %}
      </div>
    </div>
  </section>

  {# ===== Contenu principal ===== #}
  <section class="bg-white py-10">
    <div class="mx-auto grid max-w-6xl grid-cols-1 gap-8 px-4 md:grid-cols-3">

      {# Colonne gauche : image + description #}
<div class="space-y-6 md:col-span-2">
  {# Image principale homogène (900x506 via LiipImagine) #}
  <div class="relative overflow-hidden rounded-xl border border-gray-200 bg-white">
    {% if listing.images|length > 0 %}
      {% set img_path = listing.images|first.path %}
      {% if img_path == 'placeholderTE.png' %}
        <img src="{{ asset('uploads/listings/placeholderTE.png')|imagine_filter('listing_show') }}"
             alt="Image non disponible"
             class="w-full rounded-t-xl"/>
      {% else %}
        <img src="{{ asset('uploads/listings/' ~ listing.category.slug ~ '/' ~ img_path)|imagine_filter('listing_show') }}"
             alt="Image du listing {{ listing.title|e }}"
             class="w-full rounded-t-xl"/>
      {% endif %}
    {% else %}
      <img src="{{ asset('uploads/listings/placeholderTE.png')|imagine_filter('listing_show') }}"
           alt="Image non disponible"
           class="w-full rounded-t-xl"/>
    {% endif %}

    {# Bouton Favoris #}
    <button
      class="text-talenteko-orange-500 hover:bg-talenteko-peach-200 absolute top-3 right-3 flex h-10 w-10 items-center justify-center rounded-full bg-white shadow transition"
      aria-label="Ajouter aux favoris"
      data-controller="favorite-toggle"
      data-action="click->favorite-toggle#toggle"
    >
      <span data-favorite-toggle-target="empty"><i class="fa-regular fa-heart"></i></span>
      <span data-favorite-toggle-target="filled" class="hidden"><i class="fa-solid fa-heart"></i></span>
    </button>
  </div>

  {# --- Galerie d’images (si plusieurs) --- #}
  {% if listing.images|length > 1 %}
    <div class="flex gap-3 overflow-x-auto py-2">
      {% for image in listing.images|slice(1) %}
        {% if image.path == 'placeholderTE.png' %}
          <img src="{{ asset('uploads/listings/placeholderTE.png')|imagine_filter('listing_card') }}"
               alt="Image supplémentaire non disponible"
               class="h-24 w-40 object-cover rounded-lg border"/>
        {% else %}
          <img src="{{ asset('uploads/listings/' ~ listing.category.slug ~ '/' ~ image.path)|imagine_filter('listing_card') }}"
               alt="Image supplémentaire du listing {{ listing.title|e }}"
               class="h-24 w-40 object-cover rounded-lg border"/>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <article class="rounded-xl border border-gray-200 bg-white p-6">
    <h2 class="text-talenteko-blue-900 mb-3 text-xl font-bold">Description</h2>
    <div class="max-w-none whitespace-pre-line leading-relaxed text-gray-800">
      {{ listing.description }}
    </div>
  </article>
</div>
      {# Colonne droite : auteur #}
      <aside class="space-y-6">
        <div class="rounded-xl border border-gray-200 bg-white p-6">
          <h3 class="text-talenteko-blue-900 mb-4 text-lg font-semibold">Proposé par</h3>
          <div class="mb-3 flex items-center gap-3">
            <a href="{{ path('app_user_show', {id: listing.author.id}) }}" class="flex items-center gap-3 group">
              <div class="bg-talenteko-peach-200 text-talenteko-orange-500 flex h-10 w-10 items-center justify-center rounded-full font-bold group-hover:bg-talenteko-orange-500 group-hover:text-white transition">
                {{ (listing.author.pseudo ?? 'M')|slice(0, 1)|upper }}
              </div>
              <div>
                <div class="text-talenteko-blue-900 font-semibold group-hover:underline">
                  {{ listing.author.pseudo ?? 'Membre' }}
                </div>
                {% if listing.location %}
                  <div class="max-w-[120px] truncate text-sm text-gray-500">
                    {{ listing.location }}
                  </div>
                {% endif %}
              </div>
            </a>
          </div>

          {# Étoiles statiques pour l'instant #}
          <div class="text-talenteko-orange-500 flex items-center text-sm">
            {% for i in 1..5 %}
              <i class="fa-{{ i <= 4 ? 'solid' : 'regular' }} fa-star"></i>
            {% endfor %}
          </div>
        </div>

        <div class="rounded-xl border border-gray-200 bg-white p-6">
          <a href="{{ path('app_home') }}" class="text-talenteko-orange-500 flex items-center justify-center gap-2 hover:underline">
            <i class="fa-solid fa-arrow-left"></i>
            Retour à l'accueil
          </a>
        </div>
      </aside>
    </div>
  </section>

  {% include 'partials/_flash.html.twig' %}
{% endblock %}
