{# ================================
   templates/security/register.html.twig
   ================================ #}
{% extends 'base.html.twig' %}

{% block title %}
  Créer un compte | TalentÉkô
{% endblock %}

{% block body %}
  <section class="bg-talenteko-peach-100 py-12">
    <div class="mx-auto max-w-md px-6">
      <h1 class="text-talenteko-orange-500 mb-6 text-center text-3xl font-bold">
        Créer un compte
      </h1>

      {# --- Bandeau d'erreurs global --- #}
      {% if not form.vars.valid and form.vars.submitted %}
        {% include 'partials/_alert.html.twig' with {
          type: 'error',
          message: '<strong>Le formulaire contient des erreurs.</strong> Merci de vérifier les champs en rouge.',
          id: 'form-global-errors'
        } %}
      {% endif %}

      {# --- Messages flash --- #}
      {% for messages in app.flashes %}
        {% for message in messages %}
          {% include 'partials/_alert.html.twig' with {
            type: 'success',
            message: message
          } %}
        {% endfor %}
      {% endfor %}

      {# --- Formulaire d'inscription --- #}
      <div class="rounded-2xl bg-white p-6 shadow-sm">
        {{ form_start(form, {
          attr: {
            novalidate: 'novalidate',
            id: 'register-form',
            class: 'tk-form space-y-5'
          }
        }) }}

        {# EMAIL #}
        {% include 'partials/_form_field.html.twig' with {
          field: form.email,
          label: 'Adresse email',
          placeholder: 'ex. vous@exemple.fr',
          autocomplete: 'email'
        } %}

        {# PSEUDO #}
        {% include 'partials/_form_field.html.twig' with {
          field: form.pseudo,
          label: 'Pseudonyme',
          placeholder: 'ex. BricoMan42',
          autocomplete: 'nickname'
        } %}

        {# LOCALISATION #}
        {% include 'partials/_form_field.html.twig' with {
          field: form.location,
          label: 'Localisation',
          placeholder: 'ex. Paris, Lyon, Marseille',
          autocomplete: 'address-level2'
        } %}

        {# MOT DE PASSE #}
        {% include 'partials/_password_field.html.twig' with {
          field: form.plainPassword.first,
          label: 'Mot de passe',
          target: 'original'
        } %}

        {% include 'partials/_password_field.html.twig' with {
          field: form.plainPassword.second,
          label: 'Confirmer le mot de passe',
          target: 'confirm'
        } %}

        {# CONDITIONS D'UTILISATION #}
        <div class="flex items-start gap-2">
          {{ form_widget(form.agreeTerms, {attr: {class: 'mt-1'}}) }}
          <label for="{{ form.agreeTerms.vars.id }}" class="text-sm text-gray-700">
            J’accepte les
            <a href="{{ path('app_legal_conditions') }}" class="btn-link">conditions d’utilisation</a>.
          </label>
        </div>
        {{ form_errors(form.agreeTerms) }}

        <button id="submit-btn" type="submit" class="btn-primary btn-block mt-6">
          S'inscrire
        </button>

        {{ form_end(form) }}

        <p class="mt-6 text-center text-sm text-gray-600">
          Déjà inscrit ?
          <a href="{{ path('app_login') }}" class="btn-link">Se connecter</a>
        </p>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('turbo:before-cache', () => {
      const el = document.getElementById('form-global-errors');
      if (el) {
        el.remove();
      }
    });
  </script>
{% endblock %}
